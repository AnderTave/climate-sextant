<html>


<head>
    
    <script 
    src="https://d3js.org/d3.v4.min.js">
    </script>   
    
    <script 
    src="https://aframe.io/releases/0.6.0/aframe.min.js">
    </script>    
    
    <script 
    src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js">
    </script>


</head>


<body>
    <!-- caricamento traccia audio -->
    <audio id='audio1' src="rain02.mp3" autoplay loop></audio>
    
    <a-scene>
		<a-sky color="#00f1fe">
        </a-sky> 
        
	<!--<a-plane src="Aztec_calendar.png" position="0 -1.5 0" rotation="-90 0 0" width="5" height="5" ></a-plane>	-->
	
	<a-cylinder  src="Aztec_calendar.png" position="0 -1.9 0" height="1" radius="3"></a-cylinder>
	<a-cylinder  color="green"  position="0 -2 0" height="1" radius="18" fog="true"></a-cylinder>	
	
		
    <!--    <a-entity position="0 2.25 -15" particle-system="preset: rain" rotation scale visable></a-entity>  -->
        
        <a-camera>
                <a-cursor></a-cursor>
        </a-camera>
    
    </a-scene>
 
    
<script>
            // caricamento database //
            d3.csv('database.csv', data => {
            // mostrare dati in console //   
            console.log(data)
            
                var scenes = d3.select('a-scene')
                    .selectAll('.entity')
                    .data(data)
                    .enter()
                    .append('a-entity')
                    .classed('entity', true)

                    .attr('rotation', (d, i) => {
                        return '0 ' + (i*360/data.length) + ' 0'
                    })

                // funzione per creare piani //
                scenes.append('a-plane')
                    .attr('width', 1)
                    .attr('material', "side: double")
                    .attr('height', 8)
                    .attr('color', '#fff')
                    .attr('position', '0 0 -20')
                    .attr('rotation', '0 0 0')
                
                // funzione per mappare pm10 su sfera //
                scenes.append('a-sphere')
                    .attr('radius', d => d.pm10/10)
                    .attr('color', '#a3a3a3')
                    .attr('position', '0 0 -15')
               
                // scala lineare colori //
                var colors = d3.scaleLinear()
                                .domain([0, 25])
                                .range(['blue', 'red'])
                
                // audio normalizzato da o a 1, zero volume minime uno volume massimo //
                var audio = d3.scaleLinear()
                                .domain([0, 300])
                                .range([0, 1])

                // funzione per mappare il dato su colori e audio, piu selezionatore //
                scenes.on('mouseenter', function(d, i){
                    console.log(d, colors(i))
                    d3.select('a-sky')
                        .attr('color', colors(d.temperature))
                    
                    d3.select('#audio1').node().volume = audio(d.rain)
                })
            
            })
    
   //       <a-entity
     //   geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
    //    material="src: #grid; repeat: 10000 10000; transparent: true;metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>
    
    
    d3.select('body').on('click', function(){
        d3.select('#audio1').node().play()
    })

</script>
    
    
</body>
    

</html>